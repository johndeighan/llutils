{
  "version": 3,
  "file": "low-level-build.js",
  "sourceRoot": "..\\..\\",
  "sources": [
    "src\\bin\\low-level-build.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "# low-level-build.coffee\r\n#\r\n# --- Designed to run in ANY project that installs @jdeighan/llutils\r\n\r\nimport {compile} from 'svelte/compiler'\r\nimport {watch} from 'node:fs'\r\nimport chokidar from 'chokidar'\r\n\r\nimport {\r\n\tundef, defined, notdefined, assert, npmLogLevel,\r\n\tisEmpty, nonEmpty, add_s, OL, execCmd,\r\n\t} from '@jdeighan/llutils'\r\nimport {getArgs} from '@jdeighan/llutils/cmd-args'\r\nimport {\r\n\tisProjRoot, barfJSON, barfPkgJSON, isFile,\r\n\tslurpJSON, slurpPkgJSON, fileExt, withExt, mkpath,\r\n\tallFilesMatching, readTextFile, newerDestFileExists,\r\n\t} from '@jdeighan/llutils/fs'\r\nimport {brewFile} from '@jdeighan/llutils/llcoffee'\r\nimport {peggifyFile} from '@jdeighan/llutils/peggy'\r\nimport {blessFile} from '@jdeighan/llutils/cielo'\r\nimport {createElemFile} from '@jdeighan/llutils/create-elem'\r\n\r\nhFilesProcessed = {\r\n\tcoffee: 0\r\n\tpeggy: 0\r\n\tcielo: 0\r\n\tsvelte: 0\r\n\t}\r\n\r\necho = (npmLogLevel() != 'silent')\r\ndoLog = (str) =>\r\n\tif echo\r\n\t\tconsole.log str\r\n\treturn\r\n\r\n# ---------------------------------------------------------------------------\r\n# Usage:   node src/bin/low-level-build.js\r\n\r\n# ---------------------------------------------------------------------------\r\n# 1. Make sure we're in a project root directory\r\n\r\nassert isProjRoot('.', 'strict'), \"Not in package root dir\"\r\n\r\n{\r\n\t_: lNonOptions\r\n\te: echo\r\n\tf: force\r\n\tw\r\n\t} = getArgs undef, {\r\n\t_: [0,1]\r\n\te: 'boolean'\r\n\tf: 'boolean'\r\n\tw: 'boolean'\r\n\t}\r\n\r\ndoLog \"-- low-level-build --\"\r\n\r\nif oneFilePath = lNonOptions[0]\r\n\text = fileExt(oneFilePath)\r\n\tdoLog oneFilePath\r\n\tswitch ext\r\n\t\twhen '.coffee'\r\n\t\t\tbrewFile oneFilePath\r\n\t\twhen '.peggy'\r\n\t\t\tpeggifyFile oneFilePath\r\n\t\twhen '.cielo'\r\n\t\t\tblessFile oneFilePath\r\n\t\twhen '.svelte'\r\n\t\t\tcreateElemFile oneFilePath\r\n\tprocess.exit()\r\n\r\n# ---------------------------------------------------------------------------\r\n# --- A file is out of date unless a *.js file exists\r\n#        that's newer than the original file\r\n# --- But ignore files inside node_modules\r\n\r\nfileFilter = ({filePath}) =>\r\n\tif filePath.match(/node_modules/i)\r\n\t\treturn false\r\n\tif force\r\n\t\treturn true\r\n\tjsFile = withExt(filePath, '.js')\r\n\treturn ! newerDestFileExists(filePath, jsFile)\r\n\r\n# ---------------------------------------------------------------------------\r\n# 2. Search project for *.coffee files and compile them\r\n#    unless newer *.js file exists\r\n\r\nfor {relPath} from allFilesMatching('**/*.coffee', {fileFilter})\r\n\tdoLog relPath\r\n\tbrewFile relPath\r\n\thFilesProcessed.coffee += 1\r\n\r\n# ---------------------------------------------------------------------------\r\n# 3. Search src folder for *.peggy files and compile them\r\n#    unless newer *.js file exists\r\n\r\nfor {relPath} from allFilesMatching('**/*.{pegjs,peggy}', {fileFilter})\r\n\tdoLog relPath\r\n\tpeggifyFile relPath\r\n\thFilesProcessed.peggy += 1\r\n\r\n# ---------------------------------------------------------------------------\r\n# 4. Search src folder for *.cielo files and compile them\r\n#    unless newer *.js file exists\r\n\r\nfor {relPath} from allFilesMatching('**/*.cielo', {fileFilter})\r\n\tdoLog relPath\r\n\tblessFile relPath\r\n\thFilesProcessed.cielo += 1\r\n\r\n# ---------------------------------------------------------------------------\r\n# 5. Search src folder for *.svelte files and compile them\r\n#    unless newer *.js file exists\r\n\r\nfor {relPath} from allFilesMatching('**/*.svelte', {fileFilter})\r\n\tdoLog relPath\r\n\tcreateElemFile relPath\r\n\thFilesProcessed.svelte += 1\r\n\r\n# ---------------------------------------------------------------------------\r\n\r\nhBin = {}    # --- keys to add in package.json / bin\r\n\r\n# ---------------------------------------------------------------------------\r\n# --- generate a 3 letter acronym if file stub is <str>-<str>-<str>\r\n\r\ntla = (stub) =>\r\n\r\n\tif lMatches = stub.match(///^\r\n\t\t\t([a-z])(?:[a-z]*)\r\n\t\t\t\\-\r\n\t\t\t([a-z])(?:[a-z]*)\r\n\t\t\t\\-\r\n\t\t\t([a-z])(?:[a-z]*)\r\n\t\t\t$///)\r\n\t\t[_, a, b, c] = lMatches\r\n\t\treturn a + b + c\r\n\telse\r\n\t\treturn undef\r\n\r\n# ---------------------------------------------------------------------------\r\n# 4. For every *.coffee file in the 'src/bin' directory that\r\n#       has key \"shebang\" set:\r\n#       - save <stub>: <jsPath> in hBin\r\n#       - if has a tla, save <tla>: <jsPath> in hBin\r\n\r\nfor {relPath, stub} from allFilesMatching('./src/bin/**/*.coffee')\r\n\t{hMetaData} = readTextFile relPath\r\n\tif hMetaData?.shebang\r\n\t\tjsPath = withExt(relPath, '.js')\r\n\t\thBin[stub] = jsPath\r\n\t\tshort_name = tla(stub)\r\n\t\tif defined(short_name)\r\n\t\t\thBin[short_name] = jsPath\r\n\r\n# ---------------------------------------------------------------------------\r\n# 5. Add sub-keys to key 'bin' in package.json\r\n#    (create if not exists)\r\n\r\nif nonEmpty(hBin)\r\n\thJson = slurpPkgJSON()\r\n\tif ! hasKey(hJson, 'bin')\r\n\t\tdoLog \"   - add key 'bin'\"\r\n\t\thJson.bin = {}\r\n\tfor key,value of hBin\r\n\t\tif (hJson.bin[key] != value)\r\n\t\t\tdoLog \"   - add bin/#{key} = #{value}\"\r\n\t\t\thJson.bin[key] = value\r\n\tbarfPkgJSON hJson\r\n\r\nnCoffee = hFilesProcessed.coffee\r\nif (nCoffee > 0)\r\n\tdoLog \"(#{nCoffee} coffee file#{add_s(nCoffee)} compiled)\"\r\n\r\nnPeggy = hFilesProcessed.peggy\r\nif (nPeggy > 0)\r\n\tdoLog \"(#{nPeggy} peggy file#{add_s(nPeggy)} compiled)\"\r\n\r\nnCielo = hFilesProcessed.cielo\r\nif (nCielo > 0)\r\n\tdoLog \"(#{nCielo} cielo file#{add_s(nCielo)} compiled)\"\r\n\r\nif w\r\n\tconsole.log \"watching for file changes...\"\r\n\tglob = \"**/*.{coffee,peggy,cielo,svelte}\"\r\n\thOptions = {\r\n\t\tpersistent: true\r\n\t\tignoreInitial: true\r\n\t\tawaitWriteFinish: {\r\n\t\t\tstabilityThreshold: 1000,\r\n\t\t\tpollInterval: 100\r\n\t\t\t}\r\n\t\t}\r\n\tchokidar.watch(glob, hOptions).on 'all', (eventType, path) =>\r\n\t\tif path.match(/node_modules/)\r\n\t\t\treturn\r\n\t\tpath = mkpath(path)\r\n\t\tswitch eventType\r\n\t\t\twhen 'add','change'\r\n\t\t\t\tswitch fileExt(path)\r\n\t\t\t\t\twhen '.coffee'\r\n\t\t\t\t\t\tbrewFile path\r\n\t\t\t\t\t\tconsole.log \"#{eventType} #{path}\"\r\n\t\t\t\t\twhen '.peggy'\r\n\t\t\t\t\t\tpeggifyFile path\r\n\t\t\t\t\t\tconsole.log \"#{eventType} #{path}\"\r\n\t\t\t\t\twhen '.cielo'\r\n\t\t\t\t\t\tblessFile path\r\n\t\t\t\t\t\tconsole.log \"#{eventType} #{path}\"\r\n\t\t\t\t\twhen '.svelte'\r\n\t\t\t\t\t\tcreateElemFile path\r\n\t\t\t\t\t\tconsole.log \"#{eventType} #{path}\"\r\n\t\t\twhen 'unlink'\r\n\t\t\t\texecCmd \"rm #{withExt(path, '.js')}\"\r\n"
  ]
}