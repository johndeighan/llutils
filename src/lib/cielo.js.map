{
  "version": 3,
  "file": "cielo.js",
  "sourceRoot": "..\\..\\",
  "sources": [
    "src\\lib\\cielo.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "# cielo.coffee\r\n\r\nimport {findConfig, loadConfig} from \"@danielx/civet/config\"\r\nimport {parse, compile} from \"@danielx/civet\"\r\n\r\nimport {\r\n\tundef, defined, notdefined, getOptions, OL, ML, LOG,\r\n\tassert, croak, isString, isEmpty, nonEmpty,\r\n\t} from '@jdeighan/llutils'\r\nimport {indented, splitLine} from '@jdeighan/llutils/indent'\r\nimport {checkJS, execJS} from '@jdeighan/llutils/exec-utils'\r\nimport {LineFetcher} from '@jdeighan/llutils/fetcher'\r\nimport {replaceHereDocs} from '@jdeighan/llutils/heredoc'\r\n\r\n# ---------------------------------------------------------------------------\r\n# --- ASYNC!\r\n\r\nexport procCielo = (code, hMetaData={}, filePath=undef, hOptions={}) ->\r\n\r\n\tassert isString(code), \"Not a string: #{OL(code)}\"\r\n\t{debug, preprocess} = getOptions hOptions, {\r\n\t\tdebug: false\r\n\t\tpreprocess: cieloPreProcess\r\n\t\t}\r\n\r\n\tif defined(preprocess)\r\n\t\tcode = preprocess code, {hMetaData..., hOptions...}, filePath\r\n\tconfigPath = await findConfig(process.cwd())\r\n\thConfig = await loadConfig(configPath)\r\n\tjsCode = await compile code, {hConfig..., js: true}\r\n\treturn {\r\n\t\tcode: jsCode\r\n\t\t}\r\n\r\n# ---------------------------------------------------------------------------\r\n\r\nexport getCieloAST = (code) =>\r\n\r\n\treturn parse(code)\r\n\r\n# ---------------------------------------------------------------------------\r\n# --- ASYNC!\r\n\r\nexport execCielo = (code, hMetaData={}, filePath=undef, hOptions={}) ->\r\n\r\n\tdebugger\r\n\t{debug, hContext} = getOptions hOptions, {\r\n\t\tdebug: false\r\n\t\thContext: {}\r\n\t\t}\r\n\r\n\ttry\r\n\t\thResult = await procCielo(code, hMetaData, filePath)\r\n\t\tjsCode = hResult.code\r\n\tcatch err\r\n\t\tcroakJS code, err, 1\r\n\r\n\tif debug\r\n\t\tLOG \"JS Code\"\r\n\t\tLOG ML(jsCode)\r\n\r\n\tif (jsCode == 'invalid(javascript)')\r\n\t\tcroakJS code, err, 2\r\n\telse if ! checkJS(jsCode)\r\n\t\tcroakJS code, err, 3\r\n\r\n\ttry\r\n\t\thContext = execJS(jsCode, hContext)\r\n\t\tif debug\r\n\t\t\tLOG \"RESULT: #{OL(hContext)}\"\r\n\t\treturn hContext\r\n\tcatch err\r\n\t\tcroakJS code, err, 4\r\n\r\n# ---------------------------------------------------------------------------\r\n\r\ncroakJS = (code, err, id) =>\r\n\r\n\tcroak \"\"\"\r\n\t\tprocCielo() failed #{id}:\r\n\t\t#{ML(code)}\r\n\t\t(#{err.message})\r\n\t\t\"\"\"\r\n\r\n# ---------------------------------------------------------------------------\r\n# --- End file on __END__\r\n#     Replace HEREDOCs\r\n\r\nexport cieloPreProcess = (code, hMetaData={}, filePath=undef) =>\r\n\r\n\tlLines = []\r\n\tsrc = new LineFetcher(code)\r\n\twhile src.moreLines()\r\n\t\t[level, str] = splitLine(src.fetch())\r\n\t\tif (level == 0) && (str == '__END__')\r\n\t\t\tbreak\r\n\t\tstr = replaceHereDocs(level, str, src)\r\n\t\tlLines.push indented(str, level)\r\n\treturn lLines.join(\"\\n\")\r\n\r\n"
  ]
}