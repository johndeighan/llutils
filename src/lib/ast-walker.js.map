{
  "version": 3,
  "file": "ast-walker.js",
  "sourceRoot": "..\\..\\",
  "sources": [
    "src\\lib\\ast-walker.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "# ast-walker.coffee\r\n\r\nimport {\r\n\tundef, defined, notdefined, listdiff, hasKey, words,\r\n\tassert, croak, dclone, keys, OL, removeKeys,\r\n\tisString, nonEmpty,\r\n\t} from '@jdeighan/llutils'\r\nimport {DUMP} from '@jdeighan/llutils/dump'\r\nimport {extract} from '@jdeighan/llutils/data-extractor'\r\nimport {\r\n\tNodeWalker, stackMatches,\r\n\t} from '@jdeighan/llutils/node-walker'\r\n\r\n# ---------------------------------------------------------------------------\r\n\r\nexport removeExtraASTKeys = (hAST) =>\r\n\r\n\tremoveKeys hAST, words(\r\n\t\t'loc range extra start end',\r\n\t\t'directives comments tokens',\r\n\t\t)\r\n\treturn hAST\r\n\r\n# ---------------------------------------------------------------------------\r\n\r\nexport class ASTWalker extends NodeWalker\r\n\r\n\tinit: () ->\r\n\r\n\t\tsuper()\r\n\r\n\t\t# --- clone AST, remove extra keys\r\n\t\thAST = dclone(@hAST)\r\n\t\tremoveExtraASTKeys hAST\r\n\t\t@hAST = hAST\r\n\r\n\t\t@lEnvironments = [] # --- stack of Set objects\r\n\r\n\t\t@hImports = {}      # --- {<src>: <Set obj>, ...}\r\n\t\t@setExports = new Set()\r\n\t\t@setUsed = new Set()\r\n\r\n\t# ..........................................................\r\n\r\n\tpushEnv: (set) ->\r\n\r\n\t\t@lEnvironments.push set\r\n\t\treturn\r\n\r\n\t# ..........................................................\r\n\r\n\tpopEnv: () ->\r\n\r\n\t\treturn @lEnvironments.pop()\r\n\r\n\t# ..........................................................\r\n\r\n\tinEnv: (name) ->\r\n\r\n\t\tfor set in @lEnvironments\r\n\t\t\tif set.has(name)\r\n\t\t\t\treturn true\r\n\t\treturn false\r\n\r\n\t# ..........................................................\r\n\r\n\taddUsed: (name) ->\r\n\r\n\t\tif ! @inEnv(name)\r\n\t\t\t@setUsed.add(name)\r\n\t\treturn\r\n\r\n\t# ..........................................................\r\n\r\n\taddImport: (src, name) ->\r\n\r\n\t\tassert isString(name), \"Not a string: #{OL(name)}\"\r\n\t\tassert nonEmpty(name), \"Not empty: #{OL(name)}\"\r\n\t\tif hasKey(@hImports, src)\r\n\t\t\t@hImports[src].add name\r\n\t\telse\r\n\t\t\t@hImports[src] = new Set([name])\r\n\t\treturn\r\n\r\n\t# ..........................................................\r\n\r\n\taddExport: (name) ->\r\n\r\n\t\tassert ! @setExports.has(name),\r\n\t\t\t\t\"Export already declared: #{OL(name)}\"\r\n\t\t@setExports.add name\r\n\t\treturn\r\n\r\n\t# ..........................................................\r\n\r\n\tgetMissing: () ->\r\n\r\n\t\tsetMissing = new Set()\r\n\t\tfor val from @setUsed.values()\r\n\t\t\tsetMissing.add val\r\n\t\tfor src in keys(@hImports)\r\n\t\t\tfor val from @hImports[src].values()\r\n\t\t\t\tsetMissing.delete val\r\n\t\treturn setMissing\r\n\r\n\t# ..........................................................\r\n\r\n\tanalyzeExpr: (type, hNode) ->\r\n\r\n\t\t# --- Add all identifiers used in this expression\r\n\t\tswitch type\r\n\t\t\twhen 'AssignmentExpression'\r\n\t\t\t\t{left, operator, right} = hNode\r\n\t\t\t\tif (right.type == 'Identifier')\r\n\t\t\t\t\t@addUsed right.name\r\n\t\treturn\r\n\r\n\t# ..........................................................\r\n\r\n\tend: (type, hNode) ->\r\n\r\n\t\tswitch type\r\n\t\t\twhen 'ArrowFunctionExpression'\r\n\t\t\t\t@popEnv()\r\n\t\treturn\r\n\r\n\t# ..........................................................\r\n\t#    @level() gives you the level\r\n\t#    @lStack is stack of {key, hNode} to get parents\r\n\r\n\tvisit: (type, hNode) ->\r\n\r\n\t\tsuper type, hNode\r\n\t\tswitch type\r\n\r\n\t\t\twhen 'ImportDeclaration'\r\n\t\t\t\t{src, specifiers} = extract(hNode, \"\"\"\r\n\t\t\t\t\timportKind=\"value\"\r\n\t\t\t\t\t!source\r\n\t\t\t\t\t\ttype=\"StringLiteral\"\r\n\t\t\t\t\t\tvalue as src\r\n\t\t\t\t\tspecifiers\r\n\t\t\t\t\t\"\"\")\r\n\r\n\t\t\t\tfor h in specifiers\r\n\t\t\t\t\tassert (h.type == 'ImportSpecifier'), \"Bad\"\r\n\t\t\t\t\tname = h.imported.name\r\n\t\t\t\t\t@addImport src, name\r\n\r\n\t\t\twhen 'ExportNamedDeclaration'\r\n\t\t\t\t{name} = extract(hNode, \"\"\"\r\n\t\t\t\t\texportKind=\"value\"\r\n\t\t\t\t\tdeclaration\r\n\t\t\t\t\t\ttype=\"AssignmentExpression\"\r\n\t\t\t\t\t\tleft.type=\"Identifier\"\r\n\t\t\t\t\t\tleft.name\r\n\t\t\t\t\t\"\"\")\r\n\r\n\t\t\t\t@addExport name\r\n\r\n\t\t\twhen 'ExpressionStatement'\r\n\t\t\t\t{expression} = hNode\r\n\t\t\t\t@analyzeExpr expression.type, expression\r\n\r\n\t\t\twhen 'BinaryExpression'\r\n\t\t\t\t{left, operator, right} = hNode\r\n\t\t\t\tif (left.type == 'Identifier')\r\n\t\t\t\t\t@addUsed left.name\r\n\t\t\t\tif (right.type == 'Identifier')\r\n\t\t\t\t\t@addUsed right.name\r\n\r\n\t\t\twhen 'ArrowFunctionExpression'\r\n\t\t\t\t{params} = hNode\r\n\t\t\t\tset = new Set()\r\n\t\t\t\tif defined(params)\r\n\t\t\t\t\tfor parm in params\r\n\t\t\t\t\t\tif (parm.type == 'Identifier')\r\n\t\t\t\t\t\t\tset.add(parm.name)\r\n\t\t\t\t@pushEnv set\r\n"
  ]
}