{
  "version": 3,
  "file": "node-walker.js",
  "sourceRoot": "..\\..\\",
  "sources": [
    "src\\lib\\node-walker.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "# node-walker.coffee\r\n\r\nimport {\r\n\tundef, defined, notdefined, OL, getOptions, LOG,\r\n\tassert, croak, dclone, range, rev_range, centered, leftAligned,\r\n\tisString, isArray, isHash, isEmpty, DUMP,\r\n\thasKey, keys,\r\n\t} from '@jdeighan/llutils'\r\nimport {indented, undented} from '@jdeighan/llutils/indent'\r\n\r\n# ---------------------------------------------------------------------------\r\n\r\nexport stackMatches = (lStack, str) =>\r\n\r\n\tdebugger\r\n\tlPath = parsePath(str)\r\n\tif (lStack.length < lPath.length)\r\n\t\treturn false\r\n\tpos = lStack.length\r\n\tfor i from range(lPath.length)\r\n\t\tpos -= 1\r\n\t\titem = lStack[pos]\r\n\t\tif !itemMatches(item, lPath[i])\r\n\t\t\treturn false\r\n\treturn true\r\n\r\n# ---------------------------------------------------------------------------\r\n\r\nexport parsePath = (str) =>\r\n\r\n\tassert isString(str), \"Not a string: #{OL(str)}\"\r\n\tsplitter = (substr) =>\r\n\t\t[key, type] = substr.split(':')\r\n\t\tif isEmpty(key) then key = ''\r\n\t\tif isEmpty(type) then type = ''\r\n\t\treturn [key.trim(), type.trim()]\r\n\tre = /[\\r\\n\\/]+/\r\n\treturn str.split(re).map(splitter)\r\n\r\n# ---------------------------------------------------------------------------\r\n\r\nexport itemMatches = (hStackItem, [key, type]) ->\r\n\r\n\tif key && (hStackItem.key != key.trim())\r\n\t\treturn false\r\n\tif type && (hStackItem.hNode.type != type.trim())\r\n\t\treturn false\r\n\treturn true\r\n\r\n# ---------------------------------------------------------------------------\r\n# --- anything named 'item'\r\n#     can always be a node or array of nodes\r\n\r\nexport class NodeWalker\r\n\r\n\tconstructor: (hOptions={}) ->\r\n\r\n\t\t{debug: @debug} = getOptions hOptions, {\r\n\t\t\tdebug: false\r\n\t\t\t}\r\n\r\n\t\t# --- Array of {key, hNode}\r\n\t\t@lStack = []\r\n\r\n\t# ..........................................................\r\n\r\n\tdumpStack: () ->\r\n\r\n\t\tconsole.log centered('STACK', 40, 'char=-')\r\n\t\tpos = @lStack.length\r\n\t\tfor i from range(pos)\r\n\t\t\tpos -= 1\r\n\t\t\titem = @lStack[pos]\r\n\t\t\t# console.log \"#{item.key}: #{item.hNode.type}\"\r\n\t\t\tconsole.log \"{key: #{leftAligned(item.key, 12)}, hNode: {type: #{item.hNode.type}}}\"\r\n\t\tconsole.log '-'.repeat(40)\r\n\t\treturn\r\n\r\n\t# ..........................................................\r\n\r\n\tstackMatches: (str) ->\r\n\r\n\t\treturn stackMatches @lStack, str\r\n\r\n\t# ..........................................................\r\n\r\n\tlevel: () ->\r\n\r\n\t\treturn @lStack.length\r\n\r\n\t# ..........................................................\r\n\r\n\tisNode: (item) ->\r\n\r\n\t\treturn isHash(item) && hasKey(item, 'type')\r\n\r\n\t# ..........................................................\r\n\r\n\tisArrayOfNodes: (item) ->\r\n\r\n\t\tif ! isArray(item)\r\n\t\t\treturn false\r\n\t\tfor x in item\r\n\t\t\tif !@isNode(x)\r\n\t\t\t\treturn false\r\n\t\treturn true\r\n\r\n\t# ..........................................................\r\n\r\n\tdbg: (str) ->\r\n\r\n\t\tif @debug\r\n\t\t\tLOG indented(str, @level())\r\n\t\treturn\r\n\r\n\t# ..........................................................\r\n\r\n\twalk: (hAST) ->\r\n\r\n\t\tassert @isNode(hAST), \"Not a node: #{OL(hAST)}\"\r\n\t\t@init()\r\n\t\t@visit hAST.type, hAST\r\n\t\t@visitChildren hAST\r\n\t\t@end hAST\r\n\t\treturn this    # allow chaining\r\n\r\n\t# ..........................................................\r\n\r\n\tvisitChildren: (hNode) ->\r\n\r\n\t\tlKeys = keys(hNode)\r\n\t\tfor key in lKeys\r\n\t\t\tvalue = hNode[key]\r\n\t\t\t@lStack.push {key, hNode}\r\n\t\t\tif @isNode(value)\r\n\t\t\t\t@visit value.type, value\r\n\t\t\t\t@visitChildren value\r\n\t\t\t\t@end value\r\n\t\t\telse if @isArrayOfNodes(value)\r\n\t\t\t\tfor h in value\r\n\t\t\t\t\t@visit h.type, h\r\n\t\t\t\t\t@visitChildren h\r\n\t\t\t\t\t@end h\r\n\t\t\t@lStack.pop()\r\n\t\treturn\r\n\r\n\t# ..........................................................\r\n\t# --- Override these\r\n\r\n\tinit: () ->\r\n\r\n\t\t@lLines = []\r\n\t\treturn\r\n\r\n\t# ..........................................................\r\n\r\n\tvisit: (type, hNode) ->\r\n\r\n\t\t@dbg indented(\"VISIT #{type}\")\r\n\t\tstr = @stringifyNode(hNode)\r\n\t\t@lLines.push indented(str, @level())\r\n\t\treturn\r\n\r\n\t# ..........................................................\r\n\r\n\tstringifyNode: (hNode) ->\r\n\r\n\t\tif (@lStack.length == 0)\r\n\t\t\treturn hNode.type\r\n\t\telse\r\n\t\t\t{key} = @lStack.at(-1)\r\n\t\t\treturn \"#{key}: #{hNode.type}\"\r\n\r\n\t# ..........................................................\r\n\r\n\tend: (hNode) ->\r\n\r\n\t\t@dbg indented(\"END   #{hNode.type}\")\r\n\t\treturn\r\n\r\n\t# ..........................................................\r\n\r\n\tgetTrace: () ->\r\n\r\n\t\treturn @lLines.join(\"\\n\")\r\n"
  ]
}